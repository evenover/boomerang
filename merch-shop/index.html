<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/svg+xml" href="../boomerangright.svg" />
  <title>Merch Shop â€“ Boomerang & Beer 2026</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>emailjs.init('iojQYfeGiPrvBCoyS');</script>
  <style>
    /* â”€â”€ RESET & BASE â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --dark: #0d0a04;
      --body: #151009;
      --gold: #e5b84a;
      --gold-light: #f5dc7a;
      --amber: #d4762e;
      --ember: #b8461b;
      --cream: #fdf6e3;
      --glass: rgba(255,255,255,0.04);
      --glass-border: rgba(229,184,74,0.15);
      --glass-hover: rgba(229,184,74,0.08);
      --radius: 16px;
      --radius-lg: 24px;
      --glow-gold: 0 0 40px rgba(229,184,74,0.25);
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--dark);
      color: var(--cream);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    /* â”€â”€ GRAIN â”€â”€ */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      z-index: 9999;
      pointer-events: none;
      opacity: 0.03;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
      background-size: 200px;
    }

    /* â”€â”€ NAVBAR â”€â”€ */
    .navbar {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.85rem 2.5rem;
      background: rgba(13,10,4,0.85);
      backdrop-filter: blur(20px) saturate(1.4);
      -webkit-backdrop-filter: blur(20px) saturate(1.4);
      border-bottom: 1px solid var(--glass-border);
    }
    .nav-brand {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      text-decoration: none;
      color: var(--cream);
      font-weight: 700;
      font-size: 1.05rem;
    }
    .nav-brand img {
      height: 28px;
      filter: drop-shadow(0 0 6px rgba(229,184,74,0.4));
    }
    .nav-links {
      display: flex;
      list-style: none;
      gap: 1.5rem;
      align-items: center;
    }
    .nav-links a {
      color: rgba(253,246,227,0.7);
      text-decoration: none;
      font-size: 0.85rem;
      font-weight: 500;
      transition: color 0.2s;
    }
    .nav-links a:hover { color: var(--gold); }
    .nav-links .active { color: var(--gold); }

    /* â”€â”€ HEADER â”€â”€ */
    .shop-header {
      text-align: center;
      padding: 7rem 1.5rem 3rem;
      background: radial-gradient(ellipse at 50% 80%, rgba(229,184,74,0.08) 0%, transparent 70%);
    }
    .shop-header h1 {
      font-size: clamp(2rem, 5vw, 3.2rem);
      font-weight: 900;
      background: linear-gradient(135deg, var(--gold-light), var(--amber));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.03em;
    }
    .shop-header p {
      margin-top: 0.5rem;
      color: rgba(253,246,227,0.6);
      font-size: 1.05rem;
    }

    /* â”€â”€ CATEGORY FILTER â”€â”€ */
    .category-bar {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 0.6rem;
      padding: 0 1.5rem 2.5rem;
    }
    .cat-btn {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      color: rgba(253,246,227,0.7);
      font-family: inherit;
      font-size: 0.85rem;
      font-weight: 600;
      padding: 0.5rem 1.2rem;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.25s;
    }
    .cat-btn:hover { background: var(--glass-hover); color: var(--cream); }
    .cat-btn.active {
      background: linear-gradient(135deg, var(--gold), var(--amber));
      color: var(--dark);
      border-color: transparent;
    }

    /* â”€â”€ PRODUCT GRID â”€â”€ */
    .products {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1.5rem 4rem;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 2rem;
    }

    /* â”€â”€ PRODUCT CARD â”€â”€ */
    .product-card {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
    }
    .product-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--glow-gold);
      border-color: rgba(229,184,74,0.3);
    }

    /* Image area */
    .product-image-wrap {
      position: relative;
      width: 100%;
      aspect-ratio: 1 / 1;
      background: #1a150c;
      overflow: hidden;
    }
    .product-image-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.4s ease, opacity 0.3s ease;
    }
    .product-card:hover .product-image-wrap img {
      transform: scale(1.05);
    }
    .product-image-wrap .no-image {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      color: rgba(253,246,227,0.2);
      font-size: 3rem;
    }
    .price-badge {
      position: absolute;
      top: 1rem; right: 1rem;
      background: linear-gradient(135deg, var(--gold), var(--amber));
      color: var(--dark);
      font-weight: 800;
      font-size: 0.9rem;
      padding: 0.35rem 0.85rem;
      border-radius: 999px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    /* Details area */
    .product-details {
      padding: 1.25rem 1.5rem 1.5rem;
    }
    .product-name {
      font-size: 1.15rem;
      font-weight: 700;
      color: var(--cream);
      margin-bottom: 0.4rem;
    }
    .product-desc {
      font-size: 0.82rem;
      line-height: 1.55;
      color: rgba(253,246,227,0.55);
      margin-bottom: 1rem;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .product-desc.expanded {
      -webkit-line-clamp: unset;
    }
    .read-more-btn {
      background: none;
      border: none;
      color: var(--gold);
      font-family: inherit;
      font-size: 0.78rem;
      font-weight: 600;
      cursor: pointer;
      padding: 0;
      margin-bottom: 1rem;
      display: block;
    }
    .read-more-btn:hover { text-decoration: underline; }

    /* Color swatches */
    .color-section {
      margin-bottom: 1rem;
    }
    .color-section label {
      font-size: 0.72rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: rgba(253,246,227,0.45);
      display: block;
      margin-bottom: 0.5rem;
    }
    .color-swatches {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .swatch {
      width: 32px; height: 32px;
      border-radius: 50%;
      border: 2px solid transparent;
      cursor: pointer;
      transition: border-color 0.2s, transform 0.2s;
      position: relative;
    }
    .swatch:hover { transform: scale(1.15); }
    .swatch.active {
      border-color: var(--gold);
      box-shadow: 0 0 10px rgba(229,184,74,0.4);
    }
    .swatch.active::after {
      content: 'âœ“';
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 800;
      color: white;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }

    /* Swatch colors */
    .swatch[data-color="white"]    { background: #f0ece4; }
    .swatch[data-color="black"]    { background: #1a1a1a; }
    .swatch[data-color="navy"]     { background: #1a2744; }
    .swatch[data-color="burgundy"] { background: #6b1d2a; }
    .swatch[data-color="grey"]     { background: #7a7a7a; }
    .swatch[data-color="orange"]   { background: #d4762e; }
    .swatch[data-color="white"].active::after    { color: #333; text-shadow: none; }

    /* Size selector */
    .size-section {
      margin-bottom: 1rem;
    }
    .size-section label {
      font-size: 0.72rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: rgba(253,246,227,0.45);
      display: block;
      margin-bottom: 0.5rem;
    }
    .size-options {
      display: flex;
      gap: 0.4rem;
      flex-wrap: wrap;
    }
    .size-btn {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(229,184,74,0.15);
      color: rgba(253,246,227,0.7);
      font-family: inherit;
      font-size: 0.78rem;
      font-weight: 600;
      padding: 0.35rem 0.7rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .size-btn:hover {
      background: var(--glass-hover);
      color: var(--cream);
    }
    .size-btn.active {
      background: linear-gradient(135deg, var(--gold), var(--amber));
      color: var(--dark);
      border-color: transparent;
    }

    /* Add to cart / Buy CTA */
    .buy-btn, .add-to-cart-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: linear-gradient(135deg, var(--gold), var(--amber));
      color: var(--dark);
      font-family: inherit;
      font-size: 0.9rem;
      font-weight: 700;
      padding: 0.7rem 1.6rem;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      text-decoration: none;
      width: 100%;
      justify-content: center;
    }
    .buy-btn:hover, .add-to-cart-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(229,184,74,0.35);
    }
    .add-to-cart-btn.added {
      background: linear-gradient(135deg, #2ecc71, #27ae60);
      pointer-events: none;
    }

    /* â”€â”€ CART ICON (NAVBAR) â”€â”€ */
    .cart-toggle {
      position: relative;
      background: none;
      border: none;
      color: var(--cream);
      font-size: 1.35rem;
      cursor: pointer;
      padding: 0.3rem;
      transition: transform 0.2s;
    }
    .cart-toggle:hover { transform: scale(1.15); }
    .cart-badge {
      position: absolute;
      top: -6px; right: -8px;
      background: linear-gradient(135deg, var(--ember), var(--amber));
      color: white;
      font-size: 0.65rem;
      font-weight: 800;
      min-width: 18px; height: 18px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      animation: cartPop 0.3s ease;
    }
    .cart-badge.hidden { display: none; }
    @keyframes cartPop {
      0% { transform: scale(0); }
      60% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    /* â”€â”€ CART DRAWER â”€â”€ */
    .cart-overlay {
      position: fixed;
      inset: 0;
      z-index: 10001;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(4px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .cart-overlay.open { opacity: 1; pointer-events: all; }

    .cart-drawer {
      position: fixed;
      top: 0; right: 0; bottom: 0;
      z-index: 10002;
      width: min(440px, 92vw);
      background: var(--body);
      border-left: 1px solid var(--glass-border);
      transform: translateX(100%);
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      flex-direction: column;
      box-shadow: -10px 0 40px rgba(0,0,0,0.4);
    }
    .cart-drawer.open { transform: translateX(0); }

    .cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.4rem 1.5rem;
      border-bottom: 1px solid var(--glass-border);
    }
    .cart-header h2 {
      font-size: 1.15rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--gold-light), var(--amber));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .cart-close {
      background: rgba(255,255,255,0.06);
      border: 1px solid var(--glass-border);
      color: var(--cream);
      font-size: 1.1rem;
      width: 34px; height: 34px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }
    .cart-close:hover { background: rgba(255,255,255,0.12); }

    .cart-items {
      flex: 1;
      overflow-y: auto;
      padding: 1rem 1.5rem;
    }
    .cart-empty {
      text-align: center;
      padding: 3rem 1rem;
      color: rgba(253,246,227,0.35);
    }
    .cart-empty span {
      font-size: 3rem;
      display: block;
      margin-bottom: 0.8rem;
    }

    .cart-item {
      display: flex;
      gap: 1rem;
      padding: 1rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      animation: fadeSlideIn 0.3s ease;
    }
    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    .cart-item-img {
      width: 72px; height: 72px;
      border-radius: 12px;
      overflow: hidden;
      background: #1a150c;
      flex-shrink: 0;
    }
    .cart-item-img img {
      width: 100%; height: 100%;
      object-fit: cover;
    }
    .cart-item-info {
      flex: 1;
      min-width: 0;
    }
    .cart-item-name {
      font-size: 0.88rem;
      font-weight: 700;
      color: var(--cream);
      margin-bottom: 0.15rem;
    }
    .cart-item-meta {
      font-size: 0.72rem;
      color: rgba(253,246,227,0.45);
      margin-bottom: 0.5rem;
    }
    .cart-item-bottom {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .qty-controls {
      display: flex;
      align-items: center;
      gap: 0;
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      overflow: hidden;
    }
    .qty-btn {
      background: rgba(255,255,255,0.04);
      border: none;
      color: var(--cream);
      font-family: inherit;
      font-size: 0.85rem;
      font-weight: 700;
      width: 30px; height: 28px;
      cursor: pointer;
      transition: background 0.15s;
    }
    .qty-btn:hover { background: var(--glass-hover); }
    .qty-val {
      font-size: 0.8rem;
      font-weight: 700;
      color: var(--cream);
      min-width: 28px;
      text-align: center;
    }
    .cart-item-price {
      font-size: 0.85rem;
      font-weight: 700;
      color: var(--gold);
    }
    .cart-item-remove {
      background: none;
      border: none;
      color: rgba(253,246,227,0.3);
      font-size: 1rem;
      cursor: pointer;
      padding: 0.2rem;
      transition: color 0.2s;
    }
    .cart-item-remove:hover { color: #e74c3c; }

    .cart-footer {
      border-top: 1px solid var(--glass-border);
      padding: 1.2rem 1.5rem;
    }
    .cart-total {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    .cart-total-label {
      font-size: 0.9rem;
      font-weight: 600;
      color: rgba(253,246,227,0.7);
    }
    .cart-total-price {
      font-size: 1.35rem;
      font-weight: 800;
      color: var(--gold);
    }

    /* â”€â”€ CHECKOUT FORM â”€â”€ */
    .checkout-form {
      display: none;
      flex-direction: column;
      gap: 0.8rem;
      margin-top: 0.5rem;
    }
    .checkout-form.open { display: flex; }
    .checkout-input {
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--glass-border);
      color: var(--cream);
      font-family: inherit;
      font-size: 0.85rem;
      padding: 0.7rem 1rem;
      border-radius: 10px;
      outline: none;
      transition: border-color 0.2s;
    }
    .checkout-input:focus {
      border-color: var(--gold);
    }
    .checkout-input::placeholder {
      color: rgba(253,246,227,0.3);
    }
    .checkout-input.error {
      border-color: #e74c3c;
    }
    .checkout-note {
      font-size: 0.72rem;
      color: rgba(253,246,227,0.35);
      text-align: center;
    }
    .checkout-success {
      display: none;
      text-align: center;
      padding: 2rem 1rem;
      animation: fadeSlideIn 0.4s ease;
    }
    .checkout-success.show { display: block; }
    .checkout-success span { font-size: 3rem; display: block; margin-bottom: 0.5rem; }
    .checkout-success h3 { color: var(--gold); margin-bottom: 0.4rem; }
    .checkout-success p { color: rgba(253,246,227,0.55); font-size: 0.85rem; }

    /* â”€â”€ TOAST â”€â”€ */
    .toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: linear-gradient(135deg, var(--gold), var(--amber));
      color: var(--dark);
      font-family: inherit;
      font-size: 0.85rem;
      font-weight: 700;
      padding: 0.75rem 1.5rem;
      border-radius: 999px;
      z-index: 10003;
      box-shadow: 0 8px 30px rgba(0,0,0,0.4);
      opacity: 0;
      transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: none;
      white-space: nowrap;
    }
    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* â”€â”€ FOOTER â”€â”€ */
    .footer {
      text-align: center;
      padding: 3rem 1.5rem 2rem;
      border-top: 1px solid var(--glass-border);
      color: rgba(253,246,227,0.35);
      font-size: 0.8rem;
    }
    .footer a {
      color: var(--gold);
      text-decoration: none;
    }
    .footer a:hover { text-decoration: underline; }

    /* â”€â”€ PRODUCT MODAL â”€â”€ */
    .modal-overlay {
      position: fixed;
      inset: 0;
      z-index: 10000;
      background: rgba(0,0,0,0.75);
      backdrop-filter: blur(8px);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }
    .modal-overlay.open { display: flex; }
    .modal {
      background: var(--body);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      position: relative;
    }
    .modal-img {
      aspect-ratio: 1;
      background: #1a150c;
      overflow: hidden;
      border-radius: var(--radius-lg) 0 0 var(--radius-lg);
    }
    .modal-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .modal-body {
      padding: 2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .modal-close {
      position: absolute;
      top: 1rem; right: 1rem;
      background: rgba(255,255,255,0.08);
      border: 1px solid var(--glass-border);
      color: var(--cream);
      font-size: 1.2rem;
      width: 36px; height: 36px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
      z-index: 2;
    }
    .modal-close:hover { background: rgba(255,255,255,0.15); }
    .modal-name {
      font-size: 1.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--gold-light), var(--amber));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .modal-price {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--gold);
    }
    .modal-desc {
      color: rgba(253,246,227,0.65);
      font-size: 0.9rem;
      line-height: 1.6;
    }

    /* â”€â”€ RESPONSIVE â”€â”€ */
    @media (max-width: 768px) {
      .navbar { padding: 0.7rem 1.2rem; }
      .nav-links { gap: 0.8rem; }
      .nav-links a { font-size: 0.78rem; }
      .products { grid-template-columns: 1fr 1fr; gap: 1rem; padding: 0 1rem 3rem; }
      .product-details { padding: 1rem; }
      .product-name { font-size: 1rem; }
      .modal { grid-template-columns: 1fr; }
      .modal-img { border-radius: var(--radius-lg) var(--radius-lg) 0 0; max-height: 50vh; }
    }
    @media (max-width: 480px) {
      .products { grid-template-columns: 1fr; }
      .nav-links { display: none; }
    }

    /* â”€â”€ LOADING â”€â”€ */
    .loading {
      text-align: center;
      padding: 4rem 1.5rem;
      color: rgba(253,246,227,0.4);
      font-size: 1.1rem;
    }
    .loading .spinner {
      display: inline-block;
      width: 40px; height: 40px;
      border: 3px solid var(--glass-border);
      border-top-color: var(--gold);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-bottom: 1rem;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>

  <!-- â”€â”€ NAVBAR â”€â”€ -->
  <nav class="navbar">
    <a href="/" class="nav-brand">
      <img src="/boomerangright.svg" alt="Boomerang" />
      <span>Boomerang &amp; Beer</span>
    </a>
    <ul class="nav-links">
      <li><a href="/">Hjem</a></li>
      <li><a href="/merch-shop/" class="active">Merch ğŸ”¥</a></li>
      <li><a href="/scoreboard/">Scoreboard ğŸ†</a></li>
    </ul>
    <button class="cart-toggle" id="cartToggle" title="Handlekurv">
      ğŸ›’
      <span class="cart-badge hidden" id="cartBadge">0</span>
    </button>
  </nav>

  <!-- â”€â”€ HEADER â”€â”€ -->
  <div class="shop-header">
    <h1>Merch Shop ğŸ”¥</h1>
    <p>Offisiell Boomerang &amp; Beer merch â€“ representer hardest!</p>
  </div>

  <!-- â”€â”€ CATEGORY FILTER â”€â”€ -->
  <div class="category-bar" id="categoryBar"></div>

  <!-- â”€â”€ PRODUCTS â”€â”€ -->
  <div class="products" id="productsGrid">
    <div class="loading">
      <div class="spinner"></div>
      <p>Laster produkter...</p>
    </div>
  </div>

  <!-- â”€â”€ MODAL â”€â”€ -->
  <div class="modal-overlay" id="modal">
    <div class="modal">
      <button class="modal-close" id="modalClose">&times;</button>
      <div class="modal-img" id="modalImg"></div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

  <!-- â”€â”€ CART OVERLAY â”€â”€ -->
  <div class="cart-overlay" id="cartOverlay"></div>

  <!-- â”€â”€ CART DRAWER â”€â”€ -->
  <div class="cart-drawer" id="cartDrawer">
    <div class="cart-header">
      <h2>ğŸ›’ Handlekurv</h2>
      <button class="cart-close" id="cartClose">&times;</button>
    </div>
    <div class="cart-items" id="cartItems">
      <div class="cart-empty">
        <span>ğŸªƒ</span>
        <p>Handlekurven er tom</p>
      </div>
    </div>
    <div class="cart-footer" id="cartFooter" style="display:none;">
      <div class="cart-total">
        <span class="cart-total-label">Totalt</span>
        <span class="cart-total-price" id="cartTotal">0 kr</span>
      </div>
      <button class="add-to-cart-btn" id="checkoutBtn" style="background: linear-gradient(135deg, var(--gold), var(--amber));">ğŸ“¦ GÃ¥ til bestilling</button>
      <div class="checkout-form" id="checkoutForm">
        <input type="text" class="checkout-input" id="custName" placeholder="Ditt navn" required />
        <input type="email" class="checkout-input" id="custEmail" placeholder="Din e-post" required />
        <input type="tel" class="checkout-input" id="custPhone" placeholder="Telefonnummer (for Vipps-krav)" required />
        <textarea class="checkout-input" id="custComment" placeholder="Kommentar (valgfritt)" rows="2" style="resize:vertical;"></textarea>
        <button class="add-to-cart-btn" id="sendOrderBtn">ğŸ“§ Send bestilling</button>
        <p class="checkout-note">ğŸ’³ Betaling via Vipps-krav til oppgitt nummer.<br>ğŸ“¦ Bestillingen leveres ved ankomst til festivalen.</p>
      </div>
      <div class="checkout-success" id="checkoutSuccess">
        <span>ğŸ‰</span>
        <h3>Bestilling sendt!</h3>
        <p>Du mottar Vipps-krav og bekreftelse pÃ¥ e-post. Merchen leveres pÃ¥ festivalen! ğŸªƒ</p>
      </div>
    </div>
  </div>

  <!-- â”€â”€ TOAST â”€â”€ -->
  <div class="toast" id="toast"></div>

  <!-- â”€â”€ FOOTER â”€â”€ -->
  <footer class="footer">
    <p>Boomerang &amp; Beer 2026 Â· <a href="/">Tilbake til forsiden</a></p>
  </footer>

  <script>
    // â”€â”€ STATE â”€â”€
    let allProducts = [];
    let activeCategory = 'all';
    const selectedColors = {};
    const selectedSizes = {};
    let cart = JSON.parse(localStorage.getItem('bb_cart') || '[]');
    const EMAILJS_SERVICE = 'service_nlceeqp';
    const EMAILJS_ORDER_TEMPLATE = 'template_78w3hca';
    const EMAILJS_CONFIRM_TEMPLATE = 'template_oqe7mbe';

    // â”€â”€ COLOR DISPLAY NAMES â”€â”€
    const colorNames = {
      white: 'Hvit', black: 'Svart', navy: 'Navy', burgundy: 'Burgunder',
      grey: 'GrÃ¥', orange: 'Oransje'
    };

    // â”€â”€ CATEGORIES â”€â”€
    function getCategory(product) {
      const name = product.product.toLowerCase();
      if (name.includes('hoodie')) return 'Hettegenser';
      if (name.includes('crewneck')) return 'Crewneck';
      if (name.includes('tee')) return 'T-skjorte';
      if (name.includes('bucket')) return 'Bucket Hat';
      if (name.includes('snapback') || name.includes('cap')) return 'Caps';
      if (name.includes('beanie')) return 'Beanie';
      return 'Annet';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  CART LOGIC
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function saveCart() {
      localStorage.setItem('bb_cart', JSON.stringify(cart));
      updateCartBadge();
    }

    function addToCart(productIdx, color, size) {
      const product = allProducts[productIdx];
      const key = `${productIdx}-${color}-${size || 'none'}`;
      const existing = cart.find(i => i.key === key);
      if (existing) {
        existing.qty++;
      } else {
        cart.push({
          key,
          productIdx,
          name: product.product,
          color,
          size: size || null,
          price: product.price,
          image: product.image[color],
          qty: 1
        });
      }
      saveCart();
      renderCartDrawer();
      showToast(`${product.product} lagt i handlekurven!`);
    }

    function removeFromCart(key) {
      cart = cart.filter(i => i.key !== key);
      saveCart();
      renderCartDrawer();
    }

    function updateQty(key, delta) {
      const item = cart.find(i => i.key === key);
      if (!item) return;
      item.qty += delta;
      if (item.qty < 1) {
        removeFromCart(key);
        return;
      }
      saveCart();
      renderCartDrawer();
    }

    function getCartTotal() {
      return cart.reduce((sum, i) => sum + i.price * i.qty, 0);
    }

    function getCartCount() {
      return cart.reduce((sum, i) => sum + i.qty, 0);
    }

    function updateCartBadge() {
      const badge = document.getElementById('cartBadge');
      const count = getCartCount();
      badge.textContent = count;
      badge.classList.toggle('hidden', count === 0);
    }

    // â”€â”€ TOAST â”€â”€
    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.classList.add('show');
      clearTimeout(toast._timer);
      toast._timer = setTimeout(() => toast.classList.remove('show'), 2500);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  CART DRAWER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function openCart() {
      document.getElementById('cartDrawer').classList.add('open');
      document.getElementById('cartOverlay').classList.add('open');
      document.body.style.overflow = 'hidden';
      renderCartDrawer();
    }

    function closeCart() {
      document.getElementById('cartDrawer').classList.remove('open');
      document.getElementById('cartOverlay').classList.remove('open');
      document.body.style.overflow = '';
    }

    document.getElementById('cartToggle').onclick = openCart;
    document.getElementById('cartClose').onclick = closeCart;
    document.getElementById('cartOverlay').onclick = closeCart;

    function renderCartDrawer() {
      const container = document.getElementById('cartItems');
      const footer = document.getElementById('cartFooter');
      const checkoutForm = document.getElementById('checkoutForm');
      const checkoutSuccess = document.getElementById('checkoutSuccess');
      const checkoutBtn = document.getElementById('checkoutBtn');

      if (cart.length === 0) {
        container.innerHTML = '<div class="cart-empty"><span>ğŸªƒ</span><p>Handlekurven er tom</p></div>';
        footer.style.display = 'none';
        return;
      }

      footer.style.display = 'block';
      // Keep checkout state if already open
      if (!checkoutSuccess.classList.contains('show')) {
        checkoutBtn.style.display = '';
      }

      container.innerHTML = '';
      cart.forEach(item => {
        const row = document.createElement('div');
        row.className = 'cart-item';
        const colorDisplay = colorNames[item.color] || item.color;
        const meta = [colorDisplay, item.size].filter(Boolean).join(' Â· ');
        row.innerHTML = `
          <div class="cart-item-img">
            <img src="${item.image}" alt="${item.name}" />
          </div>
          <div class="cart-item-info">
            <div class="cart-item-name">${item.name}</div>
            <div class="cart-item-meta">${meta}</div>
            <div class="cart-item-bottom">
              <div class="qty-controls">
                <button class="qty-btn" data-key="${item.key}" data-delta="-1">âˆ’</button>
                <span class="qty-val">${item.qty}</span>
                <button class="qty-btn" data-key="${item.key}" data-delta="1">+</button>
              </div>
              <span class="cart-item-price">${item.price * item.qty} kr</span>
              <button class="cart-item-remove" data-key="${item.key}" title="Fjern">&times;</button>
            </div>
          </div>
        `;
        container.appendChild(row);
        // Handle broken images
        const img = row.querySelector('.cart-item-img img');
        if (img) {
          img.onerror = function() {
            this.parentNode.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:rgba(253,246,227,0.15);font-size:1.5rem">ğŸªƒ</div>';
          };
        }
      });

      // Event listeners
      container.querySelectorAll('.qty-btn').forEach(btn => {
        btn.onclick = () => updateQty(btn.dataset.key, parseInt(btn.dataset.delta));
      });
      container.querySelectorAll('.cart-item-remove').forEach(btn => {
        btn.onclick = () => removeFromCart(btn.dataset.key);
      });

      document.getElementById('cartTotal').textContent = getCartTotal() + ' kr';
    }

    // â”€â”€ CHECKOUT â”€â”€
    document.getElementById('checkoutBtn').onclick = function() {
      const form = document.getElementById('checkoutForm');
      form.classList.toggle('open');
      this.textContent = form.classList.contains('open') ? 'â† Tilbake' : 'ğŸ“¦ GÃ¥ til bestilling';
      this.style.background = form.classList.contains('open')
        ? 'rgba(255,255,255,0.06)'
        : 'linear-gradient(135deg, var(--gold), var(--amber))';
      this.style.color = form.classList.contains('open') ? 'var(--cream)' : 'var(--dark)';
    };

    document.getElementById('sendOrderBtn').onclick = async function() {
      const btn = this;
      const name = document.getElementById('custName').value.trim();
      const email = document.getElementById('custEmail').value.trim();
      const phone = document.getElementById('custPhone').value.trim();
      const comment = document.getElementById('custComment').value.trim();

      // Validate
      let valid = true;
      document.querySelectorAll('.checkout-input').forEach(i => i.classList.remove('error'));
      if (!name) { document.getElementById('custName').classList.add('error'); valid = false; }
      if (!email || !email.includes('@')) { document.getElementById('custEmail').classList.add('error'); valid = false; }
      if (!phone || phone.length < 8) { document.getElementById('custPhone').classList.add('error'); valid = false; }
      if (!valid) return;

      // Build order lines
      const lines = cart.map(item => {
        const colorDisplay = colorNames[item.color] || item.color;
        const sizePart = item.size ? `, Str: ${item.size}` : '';
        return `â€¢ ${item.name} (${colorDisplay}${sizePart}) x${item.qty} â€” ${item.price * item.qty} kr`;
      });
      const orderList = lines.join('\n');
      const total = getCartTotal() + ' kr';

      // Template parameters (used in both templates)
      const params = {
        customer_name: name,
        customer_email: email,
        customer_phone: phone || 'Ikke oppgitt',
        order_list: orderList,
        order_total: total,
        comment: comment || 'Ingen kommentar'
      };

      // Disable button while sending
      btn.disabled = true;
      btn.textContent = 'â³ Sender...';

      try {
        // 1) Send order notification to shop
        await emailjs.send(EMAILJS_SERVICE, EMAILJS_ORDER_TEMPLATE, params);

        // 2) Send confirmation to customer
        await emailjs.send(EMAILJS_SERVICE, EMAILJS_CONFIRM_TEMPLATE, params);

        // Show success
        document.getElementById('checkoutForm').classList.remove('open');
        document.getElementById('checkoutBtn').style.display = 'none';
        document.getElementById('checkoutSuccess').classList.add('show');

        // Clear cart after a short delay
        setTimeout(() => {
          cart = [];
          saveCart();
          renderCartDrawer();
          setTimeout(() => {
            document.getElementById('checkoutSuccess').classList.remove('show');
            document.getElementById('checkoutBtn').style.display = '';
            document.getElementById('checkoutBtn').textContent = 'ğŸ“¦ GÃ¥ til bestilling';
            document.getElementById('checkoutBtn').style.background = 'linear-gradient(135deg, var(--gold), var(--amber))';
            document.getElementById('checkoutBtn').style.color = 'var(--dark)';
            document.getElementById('custName').value = '';
            document.getElementById('custEmail').value = '';
            document.getElementById('custPhone').value = '';
            document.getElementById('custComment').value = '';
          }, 500);
        }, 3000);
      } catch (err) {
        console.error('EmailJS error:', err);
        showToast('Noe gikk galt â€“ prÃ¸v igjen!');
        btn.disabled = false;
        btn.textContent = 'ğŸ“§ Send bestilling';
      }
    };

    // Close cart on Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeCart();
        closeModal();
      }
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  PRODUCTS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function loadProducts() {
      try {
        const res = await fetch('/merch.json');
        allProducts = await res.json();
        allProducts.forEach((p, i) => {
          const colors = Object.keys(p.image);
          selectedColors[i] = colors[0];
          if (p.size && p.size.length) selectedSizes[i] = null; // no default size
        });
        buildCategoryBar();
        renderProducts();
        updateCartBadge();
      } catch (err) {
        document.getElementById('productsGrid').innerHTML =
          '<p class="loading">Kunne ikke laste produkter. PrÃ¸v igjen senere.</p>';
      }
    }

    function buildCategoryBar() {
      const cats = new Set();
      allProducts.forEach(p => cats.add(getCategory(p)));
      const bar = document.getElementById('categoryBar');
      bar.innerHTML = '';
      const allBtn = el('button', { class: 'cat-btn active', 'data-cat': 'all' }, 'Alle');
      allBtn.onclick = () => filterCategory('all');
      bar.appendChild(allBtn);
      cats.forEach(cat => {
        const btn = el('button', { class: 'cat-btn', 'data-cat': cat }, cat);
        btn.onclick = () => filterCategory(cat);
        bar.appendChild(btn);
      });
    }

    function filterCategory(cat) {
      activeCategory = cat;
      document.querySelectorAll('.cat-btn').forEach(b => {
        b.classList.toggle('active', b.dataset.cat === cat);
      });
      renderProducts();
    }

    function renderProducts() {
      const grid = document.getElementById('productsGrid');
      const filtered = activeCategory === 'all'
        ? allProducts
        : allProducts.filter(p => getCategory(p) === activeCategory);

      if (filtered.length === 0) {
        grid.innerHTML = '<p class="loading">Ingen produkter i denne kategorien.</p>';
        return;
      }

      grid.innerHTML = '';
      filtered.forEach(product => {
        const realIdx = allProducts.indexOf(product);
        grid.appendChild(buildCard(product, realIdx));
      });
    }

    function buildCard(product, idx) {
      const color = selectedColors[idx];
      const imgSrc = product.image[color];
      const colors = Object.keys(product.image);

      const card = el('div', { class: 'product-card' });

      // Image
      const imgWrap = el('div', { class: 'product-image-wrap' });
      const img = el('img', { src: imgSrc, alt: product.product, loading: 'lazy' });
      img.onerror = function() {
        this.style.display = 'none';
        const placeholder = el('div', { class: 'no-image' }, 'ğŸªƒ');
        this.parentNode.appendChild(placeholder);
      };
      imgWrap.appendChild(img);

      const priceBadge = el('div', { class: 'price-badge' }, `${product.price} kr`);
      imgWrap.appendChild(priceBadge);
      card.appendChild(imgWrap);

      imgWrap.style.cursor = 'pointer';
      imgWrap.onclick = () => openModal(product, idx);

      // Details
      const details = el('div', { class: 'product-details' });

      const name = el('div', { class: 'product-name' }, product.product);
      details.appendChild(name);

      const desc = el('div', { class: 'product-desc' }, product.description);
      details.appendChild(desc);

      if (product.description.length > 120) {
        const readMore = el('button', { class: 'read-more-btn' }, 'Les mer');
        readMore.onclick = () => {
          desc.classList.toggle('expanded');
          readMore.textContent = desc.classList.contains('expanded') ? 'Les mindre' : 'Les mer';
        };
        details.appendChild(readMore);
      }

      // Color swatches
      if (colors.length > 1) {
        const colorSec = el('div', { class: 'color-section' });
        const colorLabel = el('label', {}, `Farge: ${colorNames[color] || color}`);
        colorSec.appendChild(colorLabel);
        const swatches = el('div', { class: 'color-swatches' });
        colors.forEach(c => {
          const swatch = el('div', {
            class: 'swatch' + (c === color ? ' active' : ''),
            'data-color': c,
            title: colorNames[c] || c
          });
          swatch.onclick = () => {
            selectedColors[idx] = c;
            renderProducts();
          };
          swatches.appendChild(swatch);
        });
        colorSec.appendChild(swatches);
        details.appendChild(colorSec);
      }

      // Size selector
      if (product.size && product.size.length > 0) {
        const sizeSec = el('div', { class: 'size-section' });
        sizeSec.appendChild(el('label', {}, 'StÃ¸rrelse'));
        const sizeOpts = el('div', { class: 'size-options' });
        product.size.forEach(s => {
          const btn = el('button', {
            class: 'size-btn' + (selectedSizes[idx] === s ? ' active' : '')
          }, s);
          btn.onclick = () => {
            selectedSizes[idx] = s;
            renderProducts();
          };
          sizeOpts.appendChild(btn);
        });
        sizeSec.appendChild(sizeOpts);
        details.appendChild(sizeSec);
      }

      // Add to cart button
      const addBtn = el('button', { class: 'add-to-cart-btn' }, 'ğŸ›’ Legg i handlekurv');
      addBtn.onclick = () => {
        const chosenColor = selectedColors[idx];
        const chosenSize = selectedSizes[idx] || null;
        // Require size if product has sizes
        if (product.size && product.size.length > 0 && !chosenSize) {
          showToast('Velg stÃ¸rrelse fÃ¸rst!');
          return;
        }
        addToCart(idx, chosenColor, chosenSize);
        addBtn.textContent = 'âœ“ Lagt til!';
        addBtn.classList.add('added');
        setTimeout(() => {
          addBtn.textContent = 'ğŸ›’ Legg i handlekurv';
          addBtn.classList.remove('added');
        }, 1500);
      };
      details.appendChild(addBtn);

      card.appendChild(details);
      return card;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  MODAL
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function openModal(product, idx) {
      const modal = document.getElementById('modal');
      const color = selectedColors[idx];
      const imgSrc = product.image[color];
      const colors = Object.keys(product.image);

      document.getElementById('modalImg').innerHTML =
        `<img src="${imgSrc}" alt="${product.product}" onerror="this.parentNode.innerHTML='<div style=&quot;display:flex;align-items:center;justify-content:center;height:100%;font-size:5rem;color:rgba(253,246,227,0.15)&quot;>ğŸªƒ</div>'"/>`;

      const body = document.getElementById('modalBody');
      body.innerHTML = '';

      body.appendChild(el('div', { class: 'modal-name' }, product.product));
      body.appendChild(el('div', { class: 'modal-price' }, `${product.price} kr`));
      body.appendChild(el('div', { class: 'modal-desc' }, product.description));

      // Color swatches
      if (colors.length > 1) {
        const colorSec = el('div', { class: 'color-section' });
        colorSec.appendChild(el('label', {}, `Farge: ${colorNames[color] || color}`));
        const swatches = el('div', { class: 'color-swatches' });
        colors.forEach(c => {
          const swatch = el('div', {
            class: 'swatch' + (c === color ? ' active' : ''),
            'data-color': c,
            title: colorNames[c] || c
          });
          swatch.onclick = () => {
            selectedColors[idx] = c;
            openModal(product, idx);
            renderProducts();
          };
          swatches.appendChild(swatch);
        });
        colorSec.appendChild(swatches);
        body.appendChild(colorSec);
      }

      // Size selector
      if (product.size && product.size.length > 0) {
        const sizeSec = el('div', { class: 'size-section' });
        sizeSec.appendChild(el('label', {}, 'StÃ¸rrelse'));
        const sizeOpts = el('div', { class: 'size-options' });
        product.size.forEach(s => {
          const btn = el('button', {
            class: 'size-btn' + (selectedSizes[idx] === s ? ' active' : '')
          }, s);
          btn.onclick = () => {
            selectedSizes[idx] = s;
            openModal(product, idx);
            renderProducts();
          };
          sizeOpts.appendChild(btn);
        });
        sizeSec.appendChild(sizeOpts);
        body.appendChild(sizeSec);
      }

      // Add to cart in modal
      const addBtn = el('button', { class: 'add-to-cart-btn' }, 'ğŸ›’ Legg i handlekurv');
      addBtn.onclick = () => {
        const chosenColor = selectedColors[idx];
        const chosenSize = selectedSizes[idx] || null;
        if (product.size && product.size.length > 0 && !chosenSize) {
          showToast('Velg stÃ¸rrelse fÃ¸rst!');
          return;
        }
        addToCart(idx, chosenColor, chosenSize);
        addBtn.textContent = 'âœ“ Lagt til!';
        addBtn.classList.add('added');
        setTimeout(() => {
          addBtn.textContent = 'ğŸ›’ Legg i handlekurv';
          addBtn.classList.remove('added');
        }, 1500);
      };
      body.appendChild(addBtn);

      modal.classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      document.getElementById('modal').classList.remove('open');
      if (!document.getElementById('cartDrawer').classList.contains('open')) {
        document.body.style.overflow = '';
      }
    }

    document.getElementById('modalClose').onclick = closeModal;
    document.getElementById('modal').onclick = (e) => {
      if (e.target === document.getElementById('modal')) closeModal();
    };

    // â”€â”€ HELPERS â”€â”€
    function el(tag, attrs, text) {
      const e = document.createElement(tag);
      if (attrs) Object.entries(attrs).forEach(([k, v]) => {
        if (k === 'class') e.className = v;
        else if (k === 'onclick') e.setAttribute('onclick', v);
        else e.setAttribute(k, v);
      });
      if (text) e.textContent = text;
      return e;
    }

    // â”€â”€ INIT â”€â”€
    loadProducts();
  </script>
</body>
</html>
